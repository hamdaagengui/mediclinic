<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">
<!--
	iBATIS SQL object - Relational mapping for Concurrent Data
	Includes SQL features: SELECT  -->
	

<sqlMap namespace="common">

	 <parameterMap id="Person-Details-Map"   class="java.util.HashMap">
	    <parameter property="Key"    	 		javaType="java.lang.String"    mode="IN"/>
	    <parameter property="Username"  		javaType="java.lang.String"    mode="IN"/>
	 </parameterMap>
	 
	 <resultMap class="com.mediapp.domain.common.Person" id="Person-Details-Result-Map">
	 	<result property="idPerson" column="idPerson"/>
	 	<result property="firstName" column="first_name"/>
	 	<result property="lastName" column="last_name"/>
	 	<result property="middleInitial" column="middle_name"/>
	 	<result property="dateOfBirth" column="date_of_birth"/>
	 	<result property="gender" column="gender"/>
	 	<result property="landlinePhoneNumber" column="landline_phone_number"/>
	 	<result property="cellPhoneNumber" column="mobile_phone_number"/>
	 	<result property="emailID" column="email_address"/>
	 	<result property="accountStatus" column="status_of_account"/>
	 	<result property="personTypeString" column="person_type"/>
	 	<result property="password" column="ePassword"/>
	 	<result property="address.address1" column="address1" />
	 	<result property="address.address2" column="address2" />
	 	<result property="address.locality" column="locality" />
	 	<result property="address.city" column="city" />
	 	<result property="address.state" column="state" />
	 	<result property="address.country" column="country"/>
	 	<result property="username" column="user_name"/>
	 </resultMap>

	<select id="authenticateUser" parameterMap="Person-Details-Map" resultMap="Person-Details-Result-Map">
            SELECT person.idPerson,first_name,last_name,middle_name,
           date_of_birth, Gender, landline_phone_number, mobile_phone_number,
           email_address, status_of_account, person_type, AES_DECRYPT(password,?) as ePassword,
           address1, address2, locality, city, state, country,user_name
           FROM person left join address on address.personID = person.idPerson
           where 
		   upper(user_name) = upper(?) ;		   
 	</select>

	 <parameterMap id="Person-Type-Map"   class="java.util.HashMap">
	    <parameter property="Category"    		javaType="java.lang.String"    mode="IN"/>
	 </parameterMap>

	<select id="getPersonType" parameterMap="Person-Type-Map" resultClass="java.lang.String">
           SELECT code_val FROM code_decode where code_ctg = ?
 	</select>
	

	 <parameterMap id="eMail-Exists-Map"   class="java.util.HashMap">
	    <parameter property="emailID"    		javaType="java.lang.String"    mode="IN"/>
	 </parameterMap>


	<select id="checkeMailExists" parameterMap="eMail-Exists-Map" resultClass="java.lang.Integer">
           SELECT count(email_Address) FROM person where email_Address = ?
 	</select>

	 <parameterMap id="User-Exists-Map"   class="java.util.HashMap">
	    <parameter property="UserName"    		javaType="java.lang.String"    mode="IN"/>
	 </parameterMap>


	<select id="checkUserExists" parameterMap="User-Exists-Map" resultClass="java.lang.Integer">
           SELECT count(user_name) FROM person where user_name = ?
 	</select>


	<insert id="insertNewPerson">
		INSERT INTO person (idPerson, email_Address,status_of_account,person_type,password,mobile_phone_number,user_name ) 
		VALUES (#idPerson#, #emailID#,'T',#personTypeString#,AES_ENCRYPT(#password#,#key#),#cellPhoneNumber#,#username# )
	</insert>

	<insert id="insertNewAppMentPerson">
		INSERT INTO person (idPerson, email_Address,status_of_account,person_type,password,mobile_phone_number,user_name,first_name,last_name,middle_name ) 
		VALUES (#idPerson#, #emailID#,'T','AppMent',AES_ENCRYPT(#password#,#key#),#cellPhoneNumber#,#username#,#firstName#,#lastName#,#middleInitial# )
	</insert>

	
	<update id="updateProfile" >
		UPDATE person set first_name=#firstName#,last_name=#lastName#,middle_name=#middleInitial#,email_Address=#emailID#,
		date_of_birth=date_format(#dateOfBirth#, '%y-%m-%d'),gender=#gender#,landline_phone_number=#landlinePhoneNumber#,mobile_phone_number=#cellPhoneNumber#, person_type=#personTypeString#
		where user_name=#username#			
	</update>
	
	<insert id="insertAddress" >
			insert into address (address1, address2, locality, city, state, country, personID) values
			(#address.address1#, #address.address2#, #address.locality#, #address.city#, #address.state#, #address.country#, #idPerson#)
			ON DUPLICATE KEY UPDATE updated = updated + 1;
	</insert>

 	<resultMap class="com.mediapp.domain.common.CodeDecode" id="Auto-Complete-Result-Map">
	 	<result property="codeDecode" column="code_val"/>
	 	<result property="codeDescription" column="code_desc"/>
	</resultMap>
	 	
	<parameterMap id="Auto-Complete-Map"   class="java.util.HashMap">
		<parameter property="Category"    	javaType="java.lang.String"    mode="IN"/>
	    <parameter property="Code"    		javaType="java.lang.String"    mode="IN"/>
	</parameterMap>

	<select id="autoComplete" parameterMap="Auto-Complete-Map" resultMap="Auto-Complete-Result-Map">
           SELECT code_val,code_desc FROM code_decode where code_ctg = ? and code_val like ?
 	</select>
 	
 	<resultMap class="com.mediapp.domain.common.SearchResult" id="Search-Result-Map">
 		<result property="idPerson" column="idPerson"/>
	 	<result property="doctorFirstName" column="first_name"/>
	 	<result property="doctorMiddleName" column="middle_name"/>
	 	<result property="doctorLastName" column="last_name"/>
	 	<result property="address1" column="address1"/>
	 	<result property="address2" column="address2"/>
	 	<result property="locality" column="Locality"/>
	 	<result property="city" column="City"/>
	 	<result property="state" column="State"/>
	 	<result property="country" column="Country"/>
	 	<result property="doctorUserName" column="user_name"/>
	 	<result property="workStartTime" column="work_start_time"/>
	 	<result property="workEndTime" column="work_end_time"/>
	 	<result property="mondayWorking" column="monday_working"/>
	 	<result property="tuesdayWorking" column="tuesday_working"/>
	 	<result property="wednesdayWorking" column="wednesday_working"/>
	 	<result property="thursdayWorking" column="thursday_working"/>
	 	<result property="fridayWorking" column="friday_working"/>
	 	<result property="saturdayWorking" column="saturday_working"/>
	 	<result property="sundayWorking" column="sunday_working"/>	 	
	</resultMap>
	 	
	<parameterMap id="Search-Input-Map"   class="java.util.HashMap">
		<parameter property="MondayWorking"    	javaType="java.lang.String"    mode="IN"/>
		<parameter property="MondayWorking"    	javaType="java.lang.String"    mode="IN"/>
	    <parameter property="TuesdayWorking"    javaType="java.lang.String"    mode="IN"/>
	    <parameter property="TuesdayWorking"    javaType="java.lang.String"    mode="IN"/>
	    <parameter property="WednesdayWorking"  javaType="java.lang.String"    mode="IN"/>
	    <parameter property="WednesdayWorking"  javaType="java.lang.String"    mode="IN"/>
	    <parameter property="ThursdayWorking"   javaType="java.lang.String"    mode="IN"/>
	    <parameter property="ThursdayWorking"   javaType="java.lang.String"    mode="IN"/>
	    <parameter property="FridayWorking"    	javaType="java.lang.String"    mode="IN"/>
	    <parameter property="FridayWorking"    	javaType="java.lang.String"    mode="IN"/>
	    <parameter property="SaturdayWorking"   javaType="java.lang.String"    mode="IN"/>
	    <parameter property="SaturdayWorking"   javaType="java.lang.String"    mode="IN"/>
	    <parameter property="SundayWorking"    	javaType="java.lang.String"    mode="IN"/>
	    <parameter property="SundayWorking"    	javaType="java.lang.String"    mode="IN"/>
	    <parameter property="Locality"    		javaType="java.lang.String"    mode="IN"/>
	    <parameter property="Locality"    		javaType="java.lang.String"    mode="IN"/>
	    <parameter property="FirstName"    		javaType="java.lang.String"    mode="IN"/>
	    <parameter property="FirstName"    		javaType="java.lang.String"    mode="IN"/>
	    <parameter property="LastName"    		javaType="java.lang.String"    mode="IN"/>
	    <parameter property="LastName"    		javaType="java.lang.String"    mode="IN"/>
	    <parameter property="MiddleInitial"		javaType="java.lang.String"    mode="IN"/>
	    <parameter property="MiddleInitial"		javaType="java.lang.String"    mode="IN"/>	
	    <parameter property="Speciality"		javaType="java.lang.String"    mode="IN"/>
	    <parameter property="Speciality"		javaType="java.lang.String"    mode="IN"/>
	    <parameter property="HolidayDate"		javaType="java.util.Date"      mode="IN"/>
	    <parameter property="City"				javaType="java.lang.String"    mode="IN"/>
	    <parameter property="City"				javaType="java.lang.String"    mode="IN"/>	    
	    <parameter property="PersonType"		javaType="java.lang.String"    mode="IN"/>	    
	    <parameter property="PersonType"		javaType="java.lang.String"    mode="IN"/>	    
	    <parameter property="Username"			javaType="java.lang.String"    mode="IN"/>	    
	    <parameter property="Username"			javaType="java.lang.String"    mode="IN"/>
	    <parameter property="SelfPersonID"		javaType="java.lang.Integer"   mode="IN"/>
	</parameterMap>

	<select id="searchDoctor" parameterMap="Search-Input-Map" resultMap="Search-Result-Map">
			select p.idPerson, p.first_name,p.last_name, p.middle_name,
			dd.work_start_time, dd.work_end_time,
			monday_working, tuesday_working,
			wednesday_working, thursday_working,
			friday_working, saturday_working,
			sunday_working, address1,address2, Locality, City,State,Country, user_name
			from 
			person p
			left outer join  doctor_details dd 
            on p.idPerson = dd.idPerson
			left outer join address a
			on p.idPerson = a.personID			
            where 
			 (dd.monday_working = ? or ifnull(?,'')='')
            and (dd.tuesday_working  = ? or ifnull(?,'')='')
            and (dd.wednesday_working = ? or ifnull(?,'')='')
            and (dd.thursday_working = ? or ifnull(?,'')='')
            and (dd.friday_working = ? or ifnull(?,'')='')
            and (dd.saturday_working = ? or ifnull(?,'')='')
            and (dd.sunday_working = ? or ifnull(?,'')='')
            and (upper(Locality) =trim(upper(?)) or ifnull(?,'')='')
    		and (upper(first_name) = trim(upper(?)) or ifnull(?,'')='')
    		and (upper(last_name) = trim(upper(?)) or ifnull(?,'')='')
    		and (upper(middle_name) = trim(upper(?)) or ifnull(?,'')='')        
            and (upper(specialization) = trim(upper(?)) or ifnull(?,'')='')
            and (date_format(?,'%Y-%m-%d') not in
            (select date_of_holiday from holiday_calendar where dd.idDoctor_details = idDoctor))
			and (upper(city) =trim(upper(?)) or ifnull(?,'')='')
			and (upper(person_type) = trim(upper(?)) or ifnull(?,'')='')        
			and (upper(user_name) =trim(upper(?)) or ifnull(?,'')='')
			and p.idperson !=?

      </select>

 	<resultMap class="com.mediapp.domain.common.Appointment" id="Day-Appointment-Result-Map">
	 	<result property="appointmentID" 		column="idAppointment_History"/> 	
	 	<result property="headline" 			column="appointment_headline"/>
	 	<result property="dateOfAppointment" 	column="date_of_appointment"/>
	 	<result property="timeOfAppointment" 	column="time_of_appointment"/>
	 	<result property="appointmentDuration" 	column="appointment_duration"/>
	 	<result property="doctorID" 			column="idDoctor_details"/>
	 	<result property="doctorPersonID" 		column="idDoctor_details"/>
	 	<result property="patientPersonID" 		column="idPatient_details"/>
	 	<result property="doctorWorkStartTime" 	column="work_start_time"/>
	 	<result property="doctorWorkEndTime" 	column="work_end_time"/>
	 	<result property="comments"			 	column="appointment_comment"/>
	 	<result property="appointmentEndTime" 	column="appointment_end_time"/>
	 	<result property="confirmedIndicator" 	column="appointment_confirmation"/>
	</resultMap>
	 	
	<parameterMap id="Day-Appointment-Parm-Map"   class="java.util.HashMap">
		<parameter property="PersonID"    			javaType="java.lang.Integer"   	mode="IN"/>
	    <parameter property="DateOfAppointment"    	javaType="java.util.Date"   	mode="IN"/>
		<parameter property="PersonID"    			javaType="java.lang.Integer"   	mode="IN"/>
	    <parameter property="DateOfAppointment"    	javaType="java.util.Date"   	mode="IN"/>
	</parameterMap>

	<select id="dayAppointment" parameterMap="Day-Appointment-Parm-Map" resultMap="Day-Appointment-Result-Map">
		select idAppointment_History, appointment_headline,date_of_appointment,time_of_appointment, appointment_duration,ah.idDoctor_details,
		'00:00:00' as work_start_time,'00:00:00' as work_end_time,appointment_comment,appointment_end_time,appointment_confirmation,p.idPerson,idPatient_details      
		from appointment_history ah,    person p    
		where (p.idPerson=ah.idDoctor_details or p.idPerson=ah.idPatient_details)
		and p.idPerson =?
		and date_of_appointment = date_format(?,'%Y-%m-%d')
		union all    
		select 0, '','9999-12-31','23:59:59', '23:59:59',idDoctor_details,start_time,end_time,'' ,'23:59:59','',
		p.idPerson    ,0
		from doctor_work_timings dwt,    doctor_details dd,    person p    
		where dwt.doctor_id = dd.iddoctor_details    and dd.idperson = p.idperson    and (p.idPerson =? )    
		and work_day = DATE_FORMAT(?, '%W') ;       
 	</select>

 	<resultMap class="com.mediapp.domain.common.Appointment" id="Day-Appointment-Patient-Result-Map">
	 	<result property="appointmentID" 		column="idAppointment_History"/> 	
	 	<result property="headline" 			column="appointment_headline"/>
	 	<result property="dateOfAppointment" 	column="date_of_appointment"/>
	 	<result property="timeOfAppointment" 	column="time_of_appointment"/>
	 	<result property="appointmentDuration" 	column="appointment_duration"/>
	 	<result property="doctorID" 			column="idDoctor_details"/>
	 	<result property="doctorPersonID" 		column="idDoctor_details"/>
	 	<result property="doctorWorkStartTime" 	column="work_start_time"/>
	 	<result property="doctorWorkEndTime" 	column="work_end_time"/>
	 	<result property="comments"			 	column="appointment_comment"/>
	 	<result property="appointmentEndTime" 	column="appointment_end_time"/>
	 	<result property="confirmedIndicator" 	column="appointment_confirmation"/>
	</resultMap>

	<parameterMap id="Day-Appointment-Patient-Parm-Map"   class="java.util.HashMap">
		<parameter property="PersonID"    			javaType="java.lang.Integer"   	mode="IN"/>
		<parameter property="PersonID"    			javaType="java.lang.Integer"   	mode="IN"/>
	    <parameter property="DateOfAppointment"    	javaType="java.util.Date"   	mode="IN"/>
		<parameter property="PersonID"    			javaType="java.lang.Integer"   	mode="IN"/>
		<parameter property="PersonID"    			javaType="java.lang.Integer"   	mode="IN"/>
	    <parameter property="DateOfAppointment"    	javaType="java.util.Date"   	mode="IN"/>
	</parameterMap>

	<select id="dayAppointmentForPatient" parameterMap="Day-Appointment-Patient-Parm-Map" resultMap="Day-Appointment-Patient-Result-Map">
			select idAppointment_History, appointment_headline,date_of_appointment,time_of_appointment, appointment_duration,ah.idDoctor_details,appointment_comment,appointment_end_time,appointment_confirmation
			from appointment_history ah,
			patient_details pd,
			person p
			where 
			(p.person_type = 'Patient' and pd.idPerson=p.idPerson and pd.idpatient_details = ah.idDoctor_details) 
			and p.idPerson =?
			and date_of_appointment = date_format(?,'%Y-%m-%d')
			and appointment_confirmation != 'C';
 	</select>

	<parameterMap id="Day-Appointment-Parm-Map"   class="java.util.HashMap">
		<parameter property="PersonID"    			javaType="java.lang.Integer"    mode="IN"/>	    
	</parameterMap>
	
	<insert id="insertNewAppointment">
		INSERT INTO appointment_history ( idAppointment_History, idPatient_details,idDoctor_details,date_of_appointment,appointment_type,
		appointment_confirmation,time_of_appointment,appointment_comment,appointment_duration,appointment_headline,appointment_end_time ) 
		VALUES ( #appointmentID#,#patientPersonID#,#doctorPersonID#,date_format(#dateOfAppointment#, '%y-%m-%d'),'R','N',
		#timeOfAppointment#,#comments#,#appointmentDuration# ,#headline#,addtime(#timeOfAppointment#,#appointmentDuration#))
	</insert>
	
	 <parameterMap id="Personal-Details-Map"   class="java.util.HashMap">
		 <parameter property="PersonID"    	 		javaType="java.lang.Integer"    mode="IN"/>
	 </parameterMap>
	 
	 <resultMap class="com.mediapp.domain.common.Person" id="Personal-Details-Result-Map">
	 	<result property="idPerson" column="idPerson"/>
	 	<result property="firstName" column="first_name"/>
	 	<result property="lastName" column="last_name"/>
	 	<result property="middleInitial" column="middle_name"/>
	 	<result property="dateOfBirth" column="date_of_birth"/>
	 	<result property="gender" column="gender"/>
	 	<result property="landlinePhoneNumber" column="landline_phone_number"/>
	 	<result property="cellPhoneNumber" column="mobile_phone_number"/>
	 	<result property="emailID" column="email_address"/>
	 	<result property="accountStatus" column="status_of_account"/>
	 	<result property="personTypeString" column="person_type"/>
	 	<result property="address.address1" column="address1" />
	 	<result property="address.address2" column="address2" />
	 	<result property="address.locality" column="locality" />
	 	<result property="address.city" column="city" />
	 	<result property="address.state" column="state" />
	 	<result property="address.country" column="country"/>
	 	<result property="doctorDetails.registrationNumber" column="registration_id"/>
	 	<result property="doctorDetails.specialization" column="specialization"/>
	 	<result property="doctorDetails.idDoctor" column="idDoctor_details" />
	 </resultMap>

	<select id="getPersonalProfile" parameterMap="Personal-Details-Map" resultMap="Personal-Details-Result-Map">
            SELECT person.idPerson,first_name,last_name,middle_name,
           date_of_birth, Gender, landline_phone_number, mobile_phone_number,
           email_address, status_of_account, person_type, 
           address1, address2, locality, city, state, country,registration_id,specialization,ifnull(idDoctor_details,0) as idDoctor_details
           FROM person 
           left join address 
           on address.personID = person.idPerson
           left join doctor_details
           on person.idPerson = doctor_details.idPerson
           where 
		   person.idPerson=?;
	</select>
	
	<resultMap class="com.mediapp.domain.common.AppointmentTO" id="Get-Appointment-Result-Map">
		<result property="appointmentID" 				column="idAppointment_history"/>
		<result property="diagnosisID" 					column="idDiagnosis"/>
	 	<result property="headline" 					column="appointment_headline"/>
	 	<result property="dateOfAppointment" 			column="date_of_appointment"/>
	 	<result property="timeOfAppointment" 			column="time_of_appointment"/>
	 	<result property="appointmentDuration" 			column="appointment_duration"/>
	 	<result property="doctorID" 					column="idDoctor_details"/>
	 	<result property="codeICD" 						column="ICD_code"/>
	 	<result property="prescription" 				column="Prescription_name"/>
	 	<result property="dosage"		 				column="dosage"/>
	 	<result property="diagnosisTest" 				column="suggested_test"/>
	 	<result property="diagnosisTestResultUnit" 		column="test_result_value"/>
	 	<result property="diagnosisTestResultValue" 	column="test_result_unit"/>
	 	<result property="comments" 					column="appointment_comment"/>
	 	<result property="confirmationIndicator" 		column="appointment_confirmation"/>
	</resultMap>
	 	
	<parameterMap id="Get-Appointment-Parm-Map"   class="java.util.HashMap">
		<parameter property="AppointmentID"    			javaType="java.lang.Integer"   mode="IN"/>
	</parameterMap>

	<select id="getAppointment" parameterMap="Get-Appointment-Parm-Map" resultMap="Get-Appointment-Result-Map">
			 select idAppointment_history,ifnull(d.idDiagnosis,0) as idDiagnosis,
 appointment_headline,date_of_appointment,time_of_appointment, appointment_duration,ah.idDoctor_details,  
 ICD_code,Prescription_name,dosage,suggested_test,test_result_value,test_result_unit ,appointment_comment,appointment_confirmation    
 from person p    
 left OUTER join appointment_history ah
 on ah.Iddoctor_details = p.idperson
 left OUTER join diagnosis d on d.idAppointment = ah.idAppointment_History   
 left OUTER join tests t on t.fDiagnosis= d.idDiagnosis   
 left OUTER join patient_prescription pp on pp.idDiagnosis= d.idDiagnosis    
 where ah.idAppointment_History=?    and appointment_confirmation != 'C'
 order by idDiagnosis,Prescription_name,suggested_test;  
 	</select>

	<resultMap class="com.mediapp.domain.common.AppointmentForMonth" id="Get-MonthAppointment-Result-Map">
	 	<result property="dateOfAppointment" 	column="date_of_appointment"/>
	 	<result property="appointmentCount"		column="AppointmentCount"/>
	</resultMap>
	 	
	<parameterMap id="Get-MonthAppointment-Parm-Map"   class="java.util.HashMap">
		<parameter property="PersonID"    			javaType="java.lang.Integer"  		mode="IN"/>
	    <parameter property="DateOfAppointment"    	javaType="java.util.Date"   		mode="IN"/>
	    <parameter property="DateOfAppointment"    	javaType="java.util.Date"   		mode="IN"/>
	</parameterMap>

	<select id="getMonthAppointment" parameterMap="Get-MonthAppointment-Parm-Map" resultMap="Get-MonthAppointment-Result-Map">
		select date_of_appointment,count(date_of_appointment) as AppointmentCount
		from person p	
		left OUTER join appointment_history ah on      
		(p.idPerson= ah.idDoctor_details or p.idPerson= ah.idPatient_details)
		where p.idPerson =?
        and month(date_of_appointment) = month(?) 
		and year(date_of_appointment) = year(?)
		and appointment_confirmation !='C'
		group by date_of_appointment             
 
 	</select>

	 <parameterMap id="Bulk-Nextval-Parm-Map"   class="java.util.HashMap">
	    <parameter property="SequenceName" 		javaType="java.lang.String"    mode="IN"/>
	    <parameter property="HowMuch"   		javaType="java.lang.Integer"   mode="IN"/>	    
	 </parameterMap>
	 
	<select id="bulkNextVal" parameterMap="Bulk-Nextval-Parm-Map" resultClass="java.lang.Integer">
			select bulknextval(?,?);
 	</select>

	 <parameterMap id="Insert-NewDiagnosis-Parm-Map"   class="java.util.HashMap">
	    <parameter property="DiagnosisID"   		javaType="java.lang.Integer"   	mode="IN"/>
	    <parameter property="AppointmentID" 		javaType="java.lang.Integer"    mode="IN"/>
		<parameter property="Prescription"   		javaType="java.lang.String"   	mode="IN"/>	    
		<parameter property="ICDCode"   			javaType="java.lang.String"   	mode="IN"/>			    
	 </parameterMap>
	
	<insert id="insertNewDiagnosis" parameterMap="Insert-NewDiagnosis-Parm-Map">
		INSERT INTO diagnosis (idDiagnosis, idAppointment,Prescription,ICD_code ) 
		VALUES (?,?,?,? )
	</insert>

	 <parameterMap id="Insert-NewTests-Parm-Map"   class="java.util.HashMap">
	    <parameter property="diagnosisTest" 			javaType="java.lang.String"    mode="IN"/>	    
		<parameter property="diagnosisTestResultValue"  javaType="java.lang.String"   	mode="IN"/>
		<parameter property="diagnosisTestResultUnit"   javaType="java.lang.String"   	mode="IN"/>
		<parameter property="DiagnosisID"   			javaType="java.lang.Integer"   	mode="IN"/>	    	    
	 </parameterMap>

	<insert id="insertNewTests" parameterMap="Insert-NewTests-Parm-Map">
		INSERT INTO tests (suggested_Test, test_Result_Value,test_Result_Unit,fDiagnosis ) 
		VALUES (?,?,?,?)
	</insert>

	 <parameterMap id="Insert-NewPrescription-Parm-Map"   class="java.util.HashMap">
	    <parameter property="prescriptionName" 			javaType="java.lang.String"    mode="IN"/>	    
		<parameter property="dosage" 					javaType="java.lang.String"   	mode="IN"/>
		<parameter property="DiagnosisID"   			javaType="java.lang.Integer"   	mode="IN"/>	    	    
	 </parameterMap>

	<insert id="insertNewPrescription" parameterMap="Insert-NewPrescription-Parm-Map">
		INSERT INTO patient_prescription (prescription_name, dosage,idDiagnosis) 
		VALUES (?,?,?)
	</insert>

	 <parameterMap id="Insert-ScheduleJob-Parm-Map"   class="java.util.HashMap">
		<parameter property="ScheduleID" 		javaType="java.lang.Integer"    mode="IN"/>	 
	    <parameter property="Action" 			javaType="java.lang.String"    mode="IN"/>	    
		<parameter property="Comments"  		javaType="java.lang.String"   	mode="IN"/>
	 </parameterMap>

	<insert id="insertScheduleJob" parameterMap="Insert-ScheduleJob-Parm-Map">
		INSERT INTO schedule_job (idschedule_job,action,comments,effectiveDate ) 
		VALUES (?,?,?,now())
	</insert>

	 <parameterMap id="Insert-JobInputs-Parm-Map"   class="java.util.HashMap">
		<parameter property="ScheduleID" 		javaType="java.lang.Integer"    mode="IN"/>	 
	    <parameter property="InputParmName" 	javaType="java.lang.String"    mode="IN"/>	    
		<parameter property="InputParmValue"  	javaType="java.lang.String"   	mode="IN"/>
	 </parameterMap>

	<insert id="insertJobInputs" parameterMap="Insert-JobInputs-Parm-Map">
		INSERT INTO job_inputs (idschedule_job, input_parameter_name,input_parameter_value ) 
		VALUES (?,?,?)
	</insert>
	<parameterMap id="Menu-Item-Map"   class="java.util.HashMap">
	    <parameter property="UserRole"    		javaType="java.lang.String"    mode="IN"/>
	 </parameterMap>

	<select id="getMenuItems" parameterMap="Menu-Item-Map" resultClass="java.util.HashMap">
           select menu_name, menu_url from menu_to_role_mapping where role = ?;
 	</select>

	<delete id="deleteAddress" >
		delete from address where personID = #idPerson#
	</delete>
	
	<insert id="insertDoctor" >
			insert into doctor_details (idPerson) values
			(#idPerson#);
	</insert>
	
	<insert id="insertPatient" >
			insert into patient_details (idPerson) values
			(#idPerson#);
	</insert>
	
	<update id="updateDoctorDetails" >
		UPDATE doctor_details set specialization=#doctorDetails.specialization#,registration_id=#doctorDetails.registrationNumber#,
		monday_working=#doctorDetails.mondayWorking#,tuesday_working=#doctorDetails.tuesdayWorking#,
		wednesday_working=#doctorDetails.wednesdayWorking#,thursday_working=#doctorDetails.thursdayWorking#,
		friday_working=#doctorDetails.fridayWorking#,saturday_working=#doctorDetails.saturdayWorking#,
		sunday_working=#doctorDetails.sundayWorking#
		where idPerson = #idPerson#;	
	</update>

	 <parameterMap id="Insert-DoctorWorkTimings-Parm-Map"   class="java.util.HashMap">
	    <parameter property="WorkDay"   			javaType="java.lang.String"   	mode="IN"/>
	    <parameter property="StartTime" 			javaType="java.util.Date"    	mode="IN"/>
		<parameter property="EndTime"   			javaType="java.util.Date"   	mode="IN"/>	    
		<parameter property="DoctorID"   			javaType="java.lang.Integer"   	mode="IN"/>			    
	 </parameterMap>

	<insert id="insertDoctorWorkTimings"  parameterMap="Insert-DoctorWorkTimings-Parm-Map">
			insert into doctor_work_timings (work_day,start_time,end_time,doctor_id) values
			(?,?,?,?);
	</insert>

	 <parameterMap id="Docotor-WorkTimings-Parm-Map"   class="java.util.HashMap">
		 <parameter property="PersonID"    	 		javaType="java.lang.Integer"    mode="IN"/>
	 </parameterMap>
	 
	 <resultMap class="com.mediapp.domain.common.DoctorWorkTimings" id="Doctor-WorkTimings-Result-Map">
	 	<result property="workDayName" 	column="work_day" />
	 	<result property="startTime" 	column="start_time" />
	 	<result property="endTime" 		column="end_time" />
	 </resultMap>

	<select id="getDoctorWorkTimings" parameterMap="Docotor-WorkTimings-Parm-Map" resultMap="Doctor-WorkTimings-Result-Map">
		select work_day,start_time, end_time 
		from doctor_work_timings dwt,
		doctor_details dd,
		person p
		where dwt.doctor_id = dd.iddoctor_details
		and dd.idperson = p.idperson
		and p.idPerson =?;

	</select>

	<delete id="deleteDoctorWorkTimings" >
		delete from doctor_work_timings where doctor_id = #doctorDetails.idDoctor#;
	</delete>


	 <parameterMap id="Docotor-WorkTimingsForDay-Parm-Map"   class="java.util.HashMap">
		 <parameter property="PersonID"    	 		javaType="java.lang.Integer"    mode="IN"/>
		 <parameter property="AppointmentDate"  	javaType="java.util.Date"   	mode="IN"/>
	 </parameterMap>


	<select id="getDoctorWorkTimingsForDay" parameterMap="Docotor-WorkTimingsForDay-Parm-Map" resultMap="Doctor-WorkTimings-Result-Map">
		select work_day,start_time, end_time 
		from doctor_work_timings dwt,
		doctor_details dd,
		person p
		where dwt.doctor_id = dd.iddoctor_details
		and dd.idperson = p.idperson
		and (p.idPerson =? )
		and work_day = DATE_FORMAT(?, '%W');
	</select>

	<resultMap class="com.mediapp.domain.common.CodeDecode" id="Code-Decode-Result-Map">
	 	<result property="codeDecode" column="code_val"/>
	 	<result property="codeDescription" column="code_desc"/>
	</resultMap>
	 	
	<parameterMap id="Code-Decode-Map"   class="java.util.HashMap">
		<parameter property="Category"    	javaType="java.lang.String"    mode="IN"/>
	</parameterMap>

	<select id="codeDecode" parameterMap="Code-Decode-Map" resultMap="Code-Decode-Result-Map">
           SELECT code_val,code_desc FROM code_decode where code_ctg = ? ;
 	</select>


	<resultMap class="com.mediapp.domain.common.Holidays" id="Holidays-Result-Map">
	 	<result property="holidayDate" column="date_of_holiday"/>
	 	<result property="comments" column="comments"/>
	 	<result property="idDoctor" column="idDoctor"/>
	</resultMap>
	 	
	<parameterMap id="Holidays-Parm-Map"   class="java.util.HashMap">
		<parameter property="PersonID"    	javaType="java.lang.Integer"    mode="IN"/>
	</parameterMap>

	<select id="getHolidays" parameterMap="Holidays-Parm-Map" resultMap="Holidays-Result-Map">
           select date_of_holiday, comments, idDoctor
			from holiday_calendar hc,
				doctor_details dd
			where 
				dd.idDoctor_details = hc.idDoctor
				and idPerson = ?;
 	</select>

	<insert id="insertHolidays" >
			insert into holiday_calendar 
				(idholiday_calendar, date_of_holiday,idDoctor,comments) values
				(nextval('s_holiday_calendar'),#holidayDate#,#idDoctor#,#comments#)
			on duplicate key 
			update date_of_holiday= #holidayDate# , comments =#comments#;
	</insert>


	<delete id="deleteHolidays"  >
			delete from holiday_calendar
			where idDoctor = #idDoctorSingle#; 
	</delete>


	<insert id="insertPatientDocument" >
			insert into patient_document_details 
				(document_name,document_path,comments,idPatient_details) values
				(#fileName#,#filePath#,#comments#,#idPatient#);
	</insert>

	<resultMap class="com.mediapp.domain.common.PatientDetails" id="PatientDetails-Result-Map">
	 	<result property="idPatient" 	column="idPatient_details"/>
	 	<result property="weight" 		column="weight"/>
	 	<result property="height" 		column="height"/>
	 	<result property="bloodGroup" 	column="blood_group"/>
	</resultMap>

	<parameterMap id="PatientDetails-Parm-Map"   class="java.util.HashMap">
		<parameter property="PersonID"    	javaType="java.lang.Integer"    mode="IN"/>
	</parameterMap>

	<select id="getPatientDetails" parameterMap="PatientDetails-Parm-Map" resultMap="PatientDetails-Result-Map">
			select idPatient_details, weight,height,blood_group 
			from patient_details
			where idPerson =?;
 	</select>


	<parameterMap id="PatientAllergies-Parm-Map"   class="java.util.HashMap">
		<parameter property="PersonID"    	javaType="java.lang.Integer"    mode="IN"/>
	</parameterMap>

	<select id="getAllergies" parameterMap="PatientAllergies-Parm-Map" resultClass="java.lang.String">
			select allergy
			from 	patient_allergies pa,
					patient_details pd
			where pd.idPatient_details = pa.idPatient_details
				and idPerson=?;
 	</select>


	<resultMap class="com.mediapp.domain.common.MultiPartFileUploadBean" id="UploadFiles-Result-Map">
	 	<result property="fileName" 		column="document_name"/>
	 	<result property="filePath" 		column="document_path"/>
	 	<result property="comments" 		column="comments"/>
	 	<result property="idPatient" 		column="idPatient"/>
	</resultMap>

	<parameterMap id="UploadFiles-Parm-Map"   class="java.util.HashMap">
		<parameter property="PersonID"    	javaType="java.lang.Integer"    mode="IN"/>
	</parameterMap>

	<select id="getuploadedFiles" parameterMap="UploadFiles-Parm-Map" resultMap="UploadFiles-Result-Map">
		select document_name,document_path, comments, pdd.idPatient_details as idPatient
		from patient_document_details pdd,
		patient_details pd
		where 
		pd.idPatient_Details = pdd.idPatient_details
		and idPerson = ?;
 	</select>

	<update id="updatePatientDetails" >
		UPDATE patient_details set weight=#weight#,height=#height#,blood_group=#bloodGroup#
		where idPatient_details = #idPatient#;
	</update>

	<parameterMap id="InsertAllergies-Parm-Map"   class="java.util.HashMap">
		<parameter property="Allergy"    	javaType="java.lang.String"    mode="IN"/>
		<parameter property="PatientID"    	javaType="java.lang.Integer"    mode="IN"/>
	</parameterMap>


	<insert id="insertAllergies"  parameterMap="InsertAllergies-Parm-Map">
			insert into patient_allergies (allergy,idPatient_details) values
			(?,?);
	</insert>
	
	<parameterMap id="Get-Curr-Val-Parm-Map"   class="java.util.HashMap">
	    <parameter property="SequenceName" 		javaType="java.lang.String"    mode="IN"/>
	 </parameterMap>
	 
	<select id="getCurrVal" parameterMap="Get-Curr-Val-Parm-Map" resultClass="java.lang.Integer">
			select currval(?);
 	</select>

	<parameterMap id="Get-Next-Val-Parm-Map"   class="java.util.HashMap">
	    <parameter property="SequenceName" 		javaType="java.lang.String"    mode="IN"/>
	 </parameterMap>
	 
	<select id="getNextVal" parameterMap="Get-Next-Val-Parm-Map" resultClass="java.lang.Integer">
			select nextval(?);
 	</select>
	
	<parameterMap id="AppointmentConfirmation-Parm-Map"   class="java.util.HashMap">
	    <parameter property="ConfirmationIndicator" 		javaType="java.lang.String"    mode="IN"/>
		<parameter property="AppointmentID" 				javaType="java.lang.Integer"   mode="IN"/>
	 </parameterMap>

	<update id="updateAppointmentConfirmation"  parameterMap="AppointmentConfirmation-Parm-Map" >
		update appointment_history set appointment_confirmation = ? where idAppointment_history=?
	</update>

	<resultMap class="com.mediapp.domain.common.ScheduleJob" id="Get-Job-Details-Result-Map">
	 	<result property="jobId" 			column="idschedule_job"/>
	 	<result property="actionToPerform" 	column="action"/>
	 	<result property="comments" 		column="comments"/>
	 	<result property="parameterName" 	column="input_parameter_name"/>
	 	<result property="parameterValue"	column="input_parameter_value"/>
	</resultMap>


	<select id="getJobDetails"  resultMap="Get-Job-Details-Result-Map">
			select sj.idschedule_job , action,comments,input_parameter_name,input_parameter_value
				from schedule_job sj,
				job_inputs ji,
                code_decode c1                                
				where 
				ji.idschedule_job = sj.idschedule_job
				and job_status = ('SCDL')
				and effectiveDate <![CDATA[ <= ]]>now() 
                and sj.action = c1.code_ctg
                and upper(c1.code_val) = 'ON'
				order by sj.idschedule_job;

 	</select>
	
	<select id="getJobParms"  resultClass="java.util.HashMap">
			select input_parameter_name,input_parameter_value
				from job_inputs ji,
				 schedule_job sj,
                code_decode c1
				where 
				ji.idschedule_job = sj.idschedule_job
				and job_status = ('SCDL')
				and effectiveDate <![CDATA[ <= ]]>now() 
                and sj.action = c1.code_ctg
                and upper(c1.code_val) = 'ON'	;

 	</select>
 	
 	<update id="updateJobCompletionStatus" >
		UPDATE schedule_job set job_status=#jobStatus#
		where idschedule_job=#jobId#
		
	</update>
 	
 	<resultMap class="com.mediapp.domain.common.NotificationDetails" id="Notification-Result-Map">
	 	<result property="patientName" 			column="PatientName"/>
	 	<result property="patientEmailAddress" 	column="PatientEmailAddress"/>
	 	<result property="patientMobileNumber" 	column="PatientMobile"/>
	 	<result property="doctorName" 			column="DoctorName"/>
	 	<result property="doctorEmailAddress" 	column="DoctorEmailAddress"/>
	 	<result property="doctorMobileNumber" 	column="DoctorMobile"/>
	</resultMap>

	<parameterMap id="Notification-Parm-Map"   class="java.util.HashMap">
	    <parameter property="AppointmentID" 		javaType="java.lang.Integer"    mode="IN"/>
	 </parameterMap>


	<select id="getDetailsForNotification" parameterMap="Notification-Parm-Map" resultMap="Notification-Result-Map">
			select concat(patient.first_name," " , patient.middle_name, " ", patient.last_name) as PatientName, patient.email_address as PatientEmailAddress,
			patient.mobile_phone_number as PatientMobile,
			concat(doctor.first_name," " , doctor.middle_name, " ", doctor.last_name) as DoctorName, doctor.email_address as DoctorEmailAddress,
			doctor.mobile_phone_number as DoctorMobile
			from person patient,
			person doctor,
			appointment_history ah
			where 
			 ah.idPatient_details = patient.idPerson
			and ah.idDoctor_details = doctor.idPerson
			and ah.idAppointment_History=?
	</select>
 	

 	<resultMap class="com.mediapp.domain.common.CodeDecode" id="Get-Diagnosis-Result-Map">
	 	<result property="codeDecode" column="icd_10_code"/>
	 	<result property="codeDescription" column="icd_10_label"/>
	</resultMap>
	 	
	<parameterMap id="Get-Diagnosis-Map"   class="java.util.HashMap">
	    <parameter property="Code"    		javaType="java.lang.String"    mode="IN"/>
	</parameterMap>

	<select id="getICDCode" parameterMap="Get-Diagnosis-Map" resultMap="Get-Diagnosis-Result-Map">
           SELECT icd_10_code, icd_10_label FROM icd_code_10 where  icd_10_label like ?
 	</select>

 	<resultMap class="com.mediapp.domain.common.CodeDecode" id="Get-Prescription-Result-Map">
	 	<result property="codeDecode" column="prescription"/>
	 	<result property="codeDescription" column="prescription"/>
	</resultMap>
	 	
	<parameterMap id="Get-Prescription-Map"   class="java.util.HashMap">
	    <parameter property="Code"    		javaType="java.lang.String"    mode="IN"/>
	</parameterMap>

	<select id="getPrescription" parameterMap="Get-Prescription-Map" resultMap="Get-Prescription-Result-Map">
           SELECT prescription, prescription FROM prescription_meta_data where  prescription like ?
 	</select>

 	<resultMap class="com.mediapp.domain.common.CodeDecode" id="Get-Tests-Result-Map">
	 	<result property="codeDecode" column="test_description"/>
	 	<result property="codeDescription" column="test_description"/>
	</resultMap>
	 	
	<parameterMap id="Get-Tests-Map"   class="java.util.HashMap">
	    <parameter property="Code"    		javaType="java.lang.String"    mode="IN"/>
	</parameterMap>

	<select id="getTests" parameterMap="Get-Tests-Map" resultMap="Get-Tests-Result-Map">
           SELECT test_description, test_description FROM test_meta_data where  test_description like ?
 	</select>
 	
 	<update id="rescheduleAppointment" >
 		update appointment_history  set date_of_appointment=date_format(#dateOfAppointment#, '%y-%m-%d'),time_of_appointment=#timeOfAppointment#,
 		appointment_end_time =addtime(#timeOfAppointment#,#appointmentDuration#),appointment_duration=#appointmentDuration# 
		where idAppointment_History =#appointmentID#
	</update>
 	
	<parameterMap id="Get-AppointmentList-Map"   class="java.util.HashMap">
	    <parameter property="PersonID"    		javaType="java.lang.Integer"    mode="IN"/>
	</parameterMap>

	<select id="getAppointmentList"   parameterMap="Get-AppointmentList-Map" resultClass="java.lang.String">
			select group_concat(idAppointment_history) from (
			select distinct idAppointment_history
			from doctor_details dd
			left join holiday_calendar hc 
			on hc.idDoctor = dd.idDoctor_details
			left join person p
			on dd.idPerson = p.idPerson
			left join appointment_history ah
			on ah.idDoctor_details = dd.idDoctor_details
			and ah.date_of_appointment = hc.date_of_holiday
			where 
			p.idPerson =?
			order by 1) as a
 	</select>
 	
 	<resultMap class="com.mediapp.domain.common.Appointment" id="Get-AllAppointmentList-Result-Map">
	 	<result property="appointmentID" 		column="idAppointment_History"/> 	
	 	<result property="headline" 			column="appointment_headline"/>
	 	<result property="dateOfAppointment" 	column="date_of_appointment"/>
	 	<result property="timeOfAppointment" 	column="time_of_appointment"/>
	 	<result property="appointmentDuration" 	column="appointment_duration"/>
	 	<result property="comments"			 	column="appointment_comment"/>
	 	<result property="appointmentEndTime" 	column="appointment_end_time"/>
	 	<result property="confirmedIndicator" 	column="appointment_confirmation"/>
	</resultMap>
 	

	<parameterMap id="Get-AllAppointmentList-Map"   class="java.util.HashMap">
	    <parameter property="PersonID"    		javaType="java.lang.Integer"    mode="IN"/>
	</parameterMap>

	<select id="getAllAppointmentList"   parameterMap="Get-AllAppointmentList-Map" resultMap="Get-AllAppointmentList-Result-Map">
			select idAppointment_History, appointment_headline,date_of_appointment,time_of_appointment, appointment_duration,appointment_comment,appointment_end_time,appointment_confirmation		
			from appointment_history ah
			where ah.idAppointment_history in (
           select idAppointment_history from (
				select distinct idAppointment_history
				from doctor_details dd
				left join holiday_calendar hc 
				on hc.idDoctor = dd.idDoctor_details
				left join person p
				on dd.idPerson = p.idPerson
				left join appointment_history ah
				on ah.idDoctor_details = dd.idDoctor_details
				and ah.date_of_appointment = hc.date_of_holiday
				where 
				p.idPerson =?
				and appointment_confirmation != 'C' 
				order by 1) as a
            )
            order by 1    ;
 	</select>
	
	<resultMap class="com.mediapp.domain.common.NotificationDetails" id="NotificationAll-Result-Map">
	 	<result property="patientName" 			column="PatientName"/>
	 	<result property="patientEmailAddress" 	column="PatientEmailAddress"/>
	 	<result property="patientMobileNumber" 	column="PatientMobile"/>
	 	<result property="doctorName" 			column="DoctorName"/>
	 	<result property="doctorEmailAddress" 	column="DoctorEmailAddress"/>
	 	<result property="doctorMobileNumber" 	column="DoctorMobile"/>
	</resultMap>

	<parameterMap id="NotificationAll-Parm-Map"   class="java.util.HashMap">
	    <parameter property="PersonID" 		javaType="java.lang.Integer"    mode="IN"/>
	 </parameterMap>


	<select id="getDetailsForNotificationAll" parameterMap="NotificationAll-Parm-Map" resultMap="NotificationAll-Result-Map">
			select idAppointment_history, concat(patient.first_name," " , patient.middle_name, ". ", patient.last_name) as PatientName, patient.email_address as PatientEmailAddress,
			patient.mobile_phone_number as PatientMobile,
			concat(doctor.first_name," " , doctor.middle_name, ". ", doctor.last_name) as DoctorName, doctor.email_address as DoctorEmailAddress,
			doctor.mobile_phone_number as DoctorMobile
			from person patient,
			person doctor,
			patient_details pd,
			doctor_details dd,
			( select distinct idAppointment_history, ah.idPatient_details, ah.idDoctor_details
                from doctor_details dd
                left join holiday_calendar hc 
                on hc.idDoctor = dd.idDoctor_details
                left join person p
                on dd.idPerson = p.idPerson
                left join appointment_history ah
                on ah.idDoctor_details = dd.idDoctor_details
                and ah.date_of_appointment = hc.date_of_holiday
                where 
                p.idPerson =?
                and appointment_confirmation != 'C'
                order by 1     
            ) as ah
			where 
			ah.idPatient_details = dd.idDoctor_details
			and ah.idDoctor_details =pd.idPatient_details
			and pd.idPerson = patient.idPerson
			and dd.idPerson = doctor.idPerson
             order by 1;
			
	</select>
	
	<update id="cancelAllAppointment" >
		UPDATE appointment_History set appointment_confirmation = 'C'
		where idAppointment_history in (
           select idAppointment_history from (
				select distinct idAppointment_history
				from doctor_details dd
				left join holiday_calendar hc 
				on hc.idDoctor = dd.idDoctor_details
				left join person p
				on dd.idPerson = p.idPerson
				left join appointment_history ah
				on ah.idDoctor_details = dd.idDoctor_details
				and ah.date_of_appointment = hc.date_of_holiday
				where 
				p.idPerson =#personID#
				and appointment_confirmation != 'C' 
				order by 1) as a
            );	
	</update>
	
	<delete id="deleteDiagnosis" >
		delete from diagnosis where idAppointment = #appointmentID#;
	</delete>

	<delete id="deletePrescription" >
		delete from patient_prescription where idDiagnosis in (
			select idDiagnosis from diagnosis where idAppointment=#appointmentID#);

	</delete>

	<delete id="deleteTests" >
		delete from tests where fDiagnosis in (
			select idDiagnosis from diagnosis where idAppointment=#appointmentID#);
	</delete>
	
	 <parameterMap id="Work-Timings-Map"   class="java.util.HashMap">
	    <parameter property="PersonID"    		javaType="java.lang.Integer"    mode="IN"/>
	 </parameterMap>


	<select id="WorkTimings" parameterMap="Work-Timings-Map" resultClass="java.lang.String">
           select concat_ws(',',if(sunday_working!='',sunday_working,'N'),
			if(monday_working!='',monday_working,'N'),
			if(tuesday_working!='',tuesday_working,'N') ,
			if(wednesday_working!='',wednesday_working,'N'),
			if(thursday_working!='',thursday_working,'N') ,
			if(friday_working!='',friday_working,'N' ),
			if(saturday_working!='',saturday_working,'N')
			) as workdays
			from doctor_details
			where idperson =?;
 	</select>

 	<resultMap class="com.mediapp.domain.common.Appointment" id="Waiting-Confirmation-Result-Map">
	 	<result property="appointmentID" 		column="idAppointment_History"/> 	
	 	<result property="headline" 			column="appointment_headline"/>
	 	<result property="dateOfAppointment" 	column="date_of_appointment"/>
	 	<result property="timeOfAppointment" 	column="time_of_appointment"/>
	 	<result property="appointmentDuration" 	column="appointment_duration"/>
	 	<result property="patientFirstName" 	column="PatientFirstName"/>
	 	<result property="patientMiddleInitial" column="PatientMiddleInitial"/>
	 	<result property="patientLastName" 		column="PatientLastName"/>
	 	<result property="doctorFirstName" 		column="DoctorFirstName"/>
	 	<result property="doctorMiddleInitial" 	column="DoctorMiddleInitial"/>
	 	<result property="doctorLastName" 		column="DoctorLastName"/>	 		 		 		 	
	 	<result property="comments"			 	column="appointment_comment"/>
	 	<result property="appointmentEndTime" 	column="appointment_end_time"/>
	 	<result property="confirmedIndicator" 	column="appointment_confirmation"/>
	</resultMap>
	 	
	<parameterMap id="Waiting-Confirmation-Parm-Map"   class="java.util.HashMap">
		<parameter property="PersonID"    			javaType="java.lang.Integer"   	mode="IN"/>
	</parameterMap>

	<select id="getWaitingConfirmation" parameterMap="Waiting-Confirmation-Parm-Map" resultMap="Waiting-Confirmation-Result-Map">
		select idAppointment_History,date_of_appointment,time_of_appointment,appointment_confirmation,
		appointment_headline,appointment_comment,appointment_duration,appointment_end_time,
		patient.first_name as PatientFirstName, patient.middle_name as PatientMiddleInitial,  patient.last_name as PatientLastName, 
		doctor.first_name as DoctorFirstName,doctor.middle_name as DoctorMiddleInitial, doctor.last_name as DoctorLastName
		from appointment_history ah,
		person patient,
		person doctor
		where 
		ah.idPatient_details = patient.idperson
		and ah.iddoctor_details = doctor.idperson
		and ah.iddoctor_details =?
		and appointment_confirmation = 'N';
 	</select>


 	<resultMap class="com.mediapp.domain.common.Appointment" id="Reminder-Appointment-Result-Map">
	 	<result property="appointmentID" 		column="idAppointment_History"/> 	
	 	<result property="headline" 			column="appointment_headline"/>
	 	<result property="dateOfAppointment" 	column="date_of_appointment"/>
	 	<result property="timeOfAppointment" 	column="time_of_appointment"/>
	 	<result property="appointmentDuration" 	column="appointment_duration"/>
	 	<result property="patientFirstName" 	column="PatientFirstName"/>
	 	<result property="patientMiddleInitial" column="PatientMiddleInitial"/>
	 	<result property="patientLastName" 		column="PatientLastName"/>
	 	<result property="doctorFirstName" 		column="DoctorFirstName"/>
	 	<result property="doctorMiddleInitial" 	column="DoctorMiddleInitial"/>
	 	<result property="doctorLastName" 		column="DoctorLastName"/>	 		 		 		 	
	 	<result property="comments"			 	column="appointment_comment"/>
	 	<result property="appointmentEndTime" 	column="appointment_end_time"/>
	 	<result property="confirmedIndicator" 	column="appointment_confirmation"/>
	</resultMap>
	 	
	<parameterMap id="Reminder-Appointment-Parm-Map"   class="java.util.HashMap">
		<parameter property="PersonID"    			javaType="java.lang.Integer"   	mode="IN"/>
	</parameterMap>

	<select id="ReminderAppointment" parameterMap="Reminder-Appointment-Parm-Map" resultMap="Reminder-Appointment-Result-Map">
		select idAppointment_History,date_of_appointment,time_of_appointment,appointment_confirmation,
		appointment_headline,appointment_comment,appointment_duration,appointment_end_time,
		patient.first_name as PatientFirstName, patient.middle_name as PatientMiddleInitial,  patient.last_name as PatientLastName, 
		doctor.first_name as DoctorFirstName,doctor.middle_name as DoctorMiddleInitial, doctor.last_name as DoctorLastName
		from appointment_history ah,
		person patient,
		person doctor,
		code_decode cd1,
		code_decode cd2
		where 
		ah.idPatient_details = patient.idperson
		and ah.iddoctor_details = doctor.idperson
		and ah.iddoctor_details =?
		and cd1.code_ctg = 'REMINDER_END_TIME'
		and cd2.code_ctg = 'REMINDER_START_TIME'
		and date_of_appointment = current_date
		and time_to_sec(timediff(curtime(),time_of_appointment)) <![CDATA[<=]]>  cd2.code_val
		and time_to_sec(timediff(curtime(),time_of_appointment)) <![CDATA[>=]]> cd1.code_val;
 	</select>

	<insert id="insertInboundMessage">
		INSERT INTO inbound_messages (sender_number,inbound_message) 
		VALUES (#originator#,#text#);
	</insert>	

	<resultMap class="com.mediapp.domain.common.IncomingMessages" id="Get-Read-Messages-Result-Map">
	 	<result property="messageId" 		column="idinbound_messages"/>
	 	<result property="senderNumber" 	column="sender_number"/>
	 	<result property="messageText" 		column="inbound_message"/>
	</resultMap>

	 <parameterMap id="Get-Read-Messages-parm-Map"   class="java.util.HashMap">
	    <parameter property="ProcessingID" 	javaType="java.lang.String"    mode="IN"/>
	 </parameterMap>


	<select id="getReadMessages"  parameterMap="Get-Read-Messages-parm-Map" resultMap="Get-Read-Messages-Result-Map">
			select idinbound_messages , sender_number,inbound_message
				from inbound_messages im                      
				where idprocessing =? ;

 	</select>


	 <parameterMap id="update-Incoming-SMS-Map"   class="java.util.HashMap">
	    <parameter property="NewProcessingStatus" 	javaType="java.lang.String"    mode="IN"/>
	    <parameter property="NewProcessingID"		javaType="java.lang.String"    mode="IN"/>
	    <parameter property="OldProcessingStatus" 	javaType="java.lang.String"    mode="IN"/>
	    <parameter property="OldProcessingID"		javaType="java.lang.String"    mode="IN"/>
	    <parameter property="OldProcessingID"		javaType="java.lang.String"    mode="IN"/>
	 </parameterMap>

 	<update id="updateIncomingSMSJob"  parameterMap="update-Incoming-SMS-Map" >
		UPDATE inbound_messages set processing_status=?,idprocessing=?
		where processing_status=?
		and (idprocessing=?
		or ifnull(?,'')='');
		
	</update>



	<update id="updateAppointmentConfirmationThruSMS"  >
		update appointment_history set appointment_confirmation = #confirmedIndicator# where date_of_appointment =#dateOfAppointment# 
		and time_of_appointment=#timeOfAppointment# and idPatient_details= #patientPersonID#; 
	</update>


	 <parameterMap id="Check-If-Appointment-Available-parm-Map"   class="java.util.HashMap">
	    <parameter property="DateOfAppointment"    	javaType="java.util.Date"   	mode="IN"/>
	    <parameter property="TimeOfAppointment"    	javaType="java.util.Date"   	mode="IN"/>
	    <parameter property="TimeOfAppointment"    	javaType="java.util.Date"   	mode="IN"/>
	    <parameter property="AppointmentDuration"  	javaType="java.util.Date"   	mode="IN"/>
	    <parameter property="PersonID"    			javaType="java.lang.Integer"   	mode="IN"/>
	 </parameterMap>


	<select id="checkIfAppointmentAvailable"  parameterMap="Check-If-Appointment-Available-parm-Map" resultClass="java.lang.Integer">
		select count(*)
		from appointment_history
		where date_of_appointment = date_format(?,'%Y-%m-%d')
		and (DATE_FORMAT(?, '%H:%i:%s') between 
		  time_of_appointment  and addtime(time_of_appointment,appointment_duration)
		or
		addtime(DATE_FORMAT(?, '%H:%i:%s'),DATE_FORMAT(?, '%H:%i:%s')) between 
		  time_of_appointment  and addtime(time_of_appointment,appointment_duration))
		and idDoctor_details = ?
		and appointment_confirmation != 'C';

 	</select>


 	<resultMap class="com.mediapp.domain.common.Appointment" id="Check-If-Appointment-Exists-Result-Map">
	 	<result property="appointmentID" 			column="idAppointment_History"/> 	
	 	<result property="doctorUserName" 			column="user_name"/>
	</resultMap>


	 <parameterMap id="Check-If-Appointment-Exists-parm-Map"   class="java.util.HashMap">
	    <parameter property="DateOfAppointment"    	javaType="java.util.Date"   	mode="IN"/>
	    <parameter property="TimeOfAppointment"    	javaType="java.util.Date"   	mode="IN"/>
	    <parameter property="PersonID"    			javaType="java.lang.Integer"   	mode="IN"/>
	 </parameterMap>


	<select id="checkIfAppointmentExists"  parameterMap="Check-If-Appointment-Exists-parm-Map" resultMap="Check-If-Appointment-Exists-Result-Map">
		select idAppointment_history, user_name
		from appointment_history ah, 
        person dp
		where date_of_appointment = date_format(?,'%Y-%m-%d')
		and time_of_appointment =TIME_FORMAT(?, '%H:%i:%s') 
        and ah.iddoctor_details= dp.idperson
		and idPatient_details=? 
		and appointment_confirmation != 'C';
 	</select>



	<select id="ReminderForMyAppointment" parameterMap="Reminder-Appointment-Parm-Map" resultMap="Reminder-Appointment-Result-Map">
		select idAppointment_History,date_of_appointment,time_of_appointment,appointment_confirmation,
		appointment_headline,appointment_comment,appointment_duration,appointment_end_time,
		patient.first_name as PatientFirstName, patient.middle_name as PatientMiddleInitial,  patient.last_name as PatientLastName, 
		doctor.first_name as DoctorFirstName,doctor.middle_name as DoctorMiddleInitial, doctor.last_name as DoctorLastName
		from appointment_history ah,
		person patient,
		person doctor,
		code_decode cd1,
		code_decode cd2
		where 
		ah.idPatient_details = patient.idperson
		and ah.iddoctor_details = doctor.idperson
		and ah.idpatient_details =?
		and cd1.code_ctg = 'REMINDER_END_TIME'
		and cd2.code_ctg = 'REMINDER_START_TIME'
		and date_of_appointment = current_date
		and time_to_sec(timediff(curtime(),time_of_appointment)) between  cd2.code_val and cd1.code_val;
 	</select>

	
</sqlMap>
